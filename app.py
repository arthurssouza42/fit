N√∫mero do Alimento,Categoria do alimento,Descri√ß√£o dos alimentos,Umidade....,Energia..kcal.,Energia..kJ.,Prote√≠na..g.,Lip√≠deos..g.,Colesterol..mg.,Carboidrato..g.,Fibra.Alimentar..g.,Cinzas..g.,C√°lcio..mg.,Magn√©sio..mg.,Mangan√™s..mg.,F√≥sforo..mg.,Ferro..mg.,S√≥dio..mg.,Pot√°ssio..mg.,Cobre..mg.,Zinco..mg.,Retinol..mcg.,RE..mcg.,RAE..mcg.,Tiamina..mg.,Riboflavina..mg.,Piridoxina..mg.,Niacina..mg.,Vitamina.C..mg.,gramas_por_porcao
,,Arroz branco,,128.0,,2.52,0.22,,28.06,,,,,,,,,,,,,,,,,,,
,,Arroz branco,,128.0,,2.52,0.22,,28.06,,,,,,,,,,,,,,,,,,,,
,,Feij√£o preto,,77.0,,4.5,0.5,,14.0,,,,,,,,,,,,,,,,,,,
,,Feij√£o preto,,77.0,,4.5,0.5,,14.0,,,,,,,,,,,,,,,,,,,,
,,Feij√£o carioca,,76.0,,4.9,0.5,,13.6,,,,,,,,,,,,,,,,,,,
,,Feij√£o carioca,,76.0,,4.9,0.5,,13.6,,,,,,,,,,,,,,,,,,,,
,,P√£o franc√™s,,300.0,,8.0,3.5,,54.0,,,,,,,,,,,,,,,,,,,
,,P√£o franc√™s,,300.0,,8.0,3.5,,54.0,,,,,,,,,,,,,,,,,,,,
,,P√£o de forma integral,,270.0,,9.0,3.5,,43.0,,,,,,,,,,,,,,,,,,,
,,P√£o de forma integral,,270.0,,9.0,3.5,,43.0,,,,,,,,,,,,,,,,,,,,
,,P√£o de forma processado,,280.0,,8.5,4.0,,45.0,,,,,,,,,,,,,,,,,,,
,,P√£o de forma processado,,280.0,,8.5,4.0,,45.0,,,,,,,,,,,,,,,,,,,,
,,Peito de frango grelhado,,163.0,,31.0,3.6,,0.0,,,,,,,,,,,,,,,,,,,
,,Peito de frango grelhado,,163.0,,31.0,3.6,,0.0,,,,,,,,,,,,,,,,,,,,
,,Ac√©m,,219.0,,27.0,12.0,,0.0,,,,,,,,,,,,,,,,,,,
,,Ac√©m,,219.0,,27.0,12.0,,0.0,,,,,,,,,,,,,,,,,,,,
,,Lagarto,,210.0,,29.0,10.0,,0.0,,,,,,,,,,,,,,,,,,,
,,Lagarto,,210.0,,29.0,10.0,,0.0,,,,,,,,,,,,,,,,,,,,
,,Lombo,,210.0,,29.0,10.0,,0.0,,,,,,,,,,,,,,,,,,,
,,Lombo,,210.0,,29.0,10.0,,0.0,,,,,,,,,,,,,,,,,,,,
,,Pernil,,240.0,,27.0,15.0,,0.0,,,,,,,,,,,,,,,,,,,
,,Pernil,,240.0,,27.0,15.0,,0.0,,,,,,,,,,,,,,,,,,,,
,,Iogurte grego,,95.0,,7.5,4.0,,7.0,,,,,,,,,,,,,,,,,,,
,,Iogurte grego,,95.0,,7.5,4.0,,7.0,,,,,,,,,,,,,,,,,,,,
,,Whey protein (growth),,390.0,,80.0,4.0,,6.0,,,,,,,,,,,,,,,,,,,
,,Whey protein (growth),,390.0,,80.0,4.0,,6.0,,,,,,,,,,,,,,,,,,,,30
,,Granola m√£e terra cacau,,440.0,,8.0,18.0,,62.0,,,,,,,,,,,,,,,,,,,
,,Granola m√£e terra cacau,,440.0,,8.0,18.0,,62.0,,,,,,,,,,,,,,,,,,,,
,,Ovo cozido,,146.0,,13.0,10.0,,1.0,,,,,,,,,,,,,,,,,,,
,,Ovo cozido,,146.0,,13.0,10.0,,1.0,,,,,,,,,,,,,,,,,,,,
,,Queijo mussarela,,320.0,,21.0,26.0,,3.0,,,,,,,,,,,,,,,,,,,
,,Queijo mussarela,,320.0,,21.0,26.0,,3.0,,,,,,,,,,,,,,,,,,,,
,,Peito de peru (embutido),,110.0,,18.0,4.0,,1.0,,,,,,,,,,,,,,,,,,,
,,Peito de peru (embutido),,110.0,,18.0,4.0,,1.0,,,,,,,,,,,,,,,,,,,,
,,Biscoito cream cracker,,433.0,,9.0,14.0,,71.0,,,,,,,,,,,,,,,,,,,
,,Biscoito cream cracker,,433.0,,9.0,14.0,,71.0,,,,,,,,,,,,,,,,,,,,
,,Maionese,,600.0,,1.0,66.0,,1.0,,,,,,,,,,,,,,,,,,,
,,Maionese,,600.0,,1.0,66.0,,1.0,,,,,,,,,,,,,,,,,,,,
,,Barra de prote√≠na crisp integral m√©dica,,372.0,,32.0,14.0,,31.0,,,,,,,,,,,,,,,,,,,
,,Barra de prote√≠na crisp integral m√©dica,,372.0,,32.0,14.0,,31.0,,,,,,,,,,,,,,,,,,,,
,,Barra de prote√≠na choco wheyfer,,431.0,,30.0,17.0,,30.0,,,,,,,,,,,,,,,,,,,
,,Barra de prote√≠na choco wheyfer,,431.0,,30.0,17.0,,30.0,,,,,,,,,,,,,,,,,,,,
,,Barra de prote√≠na mukebar,,390.0,,32.0,14.0,,32.0,,,,,,,,,,,,,,,,,,,
,,Barra de prote√≠na mukebar,,390.0,,32.0,14.0,,32.0,,,,,,,,,,,,,,,,,,,,
,,Kit Kat branco,,520.0,,5.0,27.0,,65.0,,,,,,,,,,,,,,,,,,,
,,Kit Kat branco,,520.0,,5.0,27.0,,65.0,,,,,,,,,,,,,,,,,,,,
,,Sneakers branco,,480.0,,8.0,22.0,,64.0,,,,,,,,,,,,,,,,,,,
,,Sneakers branco,,480.0,,8.0,22.0,,64.0,,,,,,,,,,,,,,,,,,,,
,,Prest√≠gio branco,,500.0,,5.0,28.0,,62.0,,,,,,,,,,,,,,,,,,,
,,Prest√≠gio branco,,500.0,,5.0,28.0,,62.0,,,,,,,,,,,,,,,,,,,,
,,Chocolate Trento,,510.0,,4.0,27.0,,64.0,,,,,,,,,,,,,,,,,,,
,,Chocolate Trento,,510.0,,4.0,27.0,,64.0,,,,,,,,,,,,,,,,,,,,
,,Batata inglesa cozida,,52.0,,1.1,0.1,,11.9,,,,,,,,,,,,,,,,,,,
,,Batata inglesa cozida,,52.0,,1.1,0.1,,11.9,,,,,,,,,,,,,,,,,,,,
,,Batata Mais Brasil (airfryer),,115.0,,1.6,3.5,,19.6,,,,,,,,,,,,,,,,,,,
,,Batata Mais Brasil (airfryer),,115.0,,1.6,3.5,,19.6,,,,,,,,,,,,,,,,,,,,
,,Doce de leite,,306.0,,5.4,6.0,,55.7,,,,,,,,,,,,,,,,,,,
,,Doce de leite,,306.0,,5.4,6.0,,55.7,,,,,,,,,,,,,,,,,,,,
,,Biscoito wafer piraqu√™,,487.0,,5.2,20.0,,71.7,,,,,,,,,,,,,,,,,,,
,,Biscoito wafer piraqu√™,,487.0,,5.2,20.0,,71.7,,,,,,,,,,,,,,,,,,,,
,,Farofa caseira,,380.0,,6.5,15.0,,50.0,,,,,,,,,,,,,,,,,,,
,,Farofa caseira,,380.0,,6.5,15.0,,50.0,,,,,,,,,,,,,,,,,,,,
,,Farofa industrializada,,410.0,,5.0,18.0,,54.0,,,,,,,,,,,,,,,,,,,
,,Farofa industrializada,,410.0,,5.0,18.0,,54.0,,,,,,,,,,,,,,,,,,,,


app.py
+74-11
import streamlit as st
import pandas as pd
import unicodedata
from datetime import datetime

# Fun√ß√£o para carregar e processar a tabela de alimentos
@st.cache_data
def carregar_tabela_alimentos():
    df = pd.read_csv("alimentos.csv")
    df["Alimento"] = df["Descri√ß√£o dos alimentos"].apply(
        lambda x: unicodedata.normalize("NFKD", str(x))
        .encode("ASCII", "ignore")
        .decode("utf-8")
        .lower()
    )
    df = df[
        [
            "Alimento",
            "Energia..kcal.",
            "Prote√≠na..g.",
            "Lip√≠deos..g.",
            "Carboidrato..g.",
            "gramas_por_porcao",
        ]
    ]
    df.columns = [
        "Alimento",
        "Kcal",
        "Proteina",
        "Gordura",
        "Carboidrato",
        "GramasPorPorcao",
    ]
    return df

# Fun√ß√£o para somar os nutrientes de um DataFrame
def somar_nutrientes(df):
    return df[["Kcal", "Proteina", "Gordura", "Carboidrato"]].sum()

# In√≠cio do app
st.title("üìí Registro Alimentar Di√°rio")

# Data no formato DD/MM/AAAA
data_input = st.date_input("Selecione a data:", format="DD/MM/YYYY")
data_str = data_input.strftime("%d/%m/%Y")

# Inicializar sess√£o por data
if "refeicoes_por_dia" not in st.session_state:
    st.session_state.refeicoes_por_dia = {}

if data_str not in st.session_state.refeicoes_por_dia:
    st.session_state.refeicoes_por_dia[data_str] = {}

refeicoes = st.session_state.refeicoes_por_dia[data_str]

# Carregar base de dados
df_alimentos = carregar_tabela_alimentos()

refeicao = st.selectbox("Selecione a refei√ß√£o", ["Caf√© da manh√£", "Almo√ßo", "Jantar", "Lanche"])
entrada = st.text_input("Digite o nome do alimento (ex: arroz, feijao, frango):").strip().lower()

# Usar pesquisa literal para evitar erro ao digitar caracteres especiais
resultado = df_alimentos[df_alimentos["Alimento"].str.contains(entrada, case=False, na=False, regex=False)]

if not resultado.empty:
    opcoes = resultado["Alimento"].unique().tolist()
    alimento_selecionado = st.selectbox("Selecione o alimento desejado:", opcoes)
    alimento_escolhido = resultado[resultado["Alimento"] == alimento_selecionado].iloc[0]

    gramas_por_porcao = alimento_escolhido.get("GramasPorPorcao")
    porcoes = None
    if pd.notna(gramas_por_porcao):
        unidade = st.radio(
            "Escolha a unidade",
            ["gramas", "por√ß√µes"],
            horizontal=True,
        )
        if unidade == "gramas":
            quantidade = st.number_input(
                "Quantidade consumida (g)",
                min_value=0.0,
                value=float(gramas_por_porcao),
                step=10.0,
            )
            porcoes = quantidade / gramas_por_porcao if gramas_por_porcao else None
        else:
            porcoes = st.number_input(
                "Quantidade consumida (por√ß√µes)",
                min_value=0.0,
                value=1.0,
                step=0.5,
            )
            quantidade = porcoes * gramas_por_porcao
    else:
        quantidade = st.number_input(
            "Quantidade consumida (g)",
            min_value=0.0,
            value=100.0,
            step=10.0,
        )

    if st.button("Adicionar alimento"):
        dados = alimento_escolhido.copy()
        fator = quantidade / 100.0
        dados[["Kcal", "Proteina", "Gordura", "Carboidrato"]] *= fator
        dados["Quantidade (g)"] = quantidade
        dados["Porcoes"] = porcoes
        dados["Hor√°rio"] = datetime.now().strftime("%H:%M")
        dados["Data"] = data_str
        dados["Refeicao"] = refeicao

        if refeicao not in refeicoes:
            refeicoes[refeicao] = pd.DataFrame()

        refeicoes[refeicao] = pd.concat(
            [refeicoes[refeicao], pd.DataFrame([dados])],
            ignore_index=True
        )
        st.rerun()

# Mostrar resumo
st.subheader(f"Resumo do dia ({data_str})")

total_df = pd.DataFrame()
for refeicao, df in refeicoes.items():
    if df.empty:
        continue

    # Calcular totais parciais
    totais_parciais = somar_nutrientes(df)
    resumo_macros = (
        f"**Calorias:** {totais_parciais['Kcal']:.0f} kcal | "
        f"**Prote√≠nas:** {totais_parciais['Proteina']:.1f} g | "
        f"**Gorduras:** {totais_parciais['Gordura']:.1f} g | "
        f"**Carboidratos:** {totais_parciais['Carboidrato']:.1f} g"
    )

    # T√≠tulo da refei√ß√£o + resumo parcial
    st.markdown(f"üçΩÔ∏è **{refeicao}**\n\n{resumo_macros}")

    colunas = [
        "Alimento",
        "Quantidade (g)",
        "Porcoes",
        "Kcal",
        "Proteina",
        "Gordura",
        "Carboidrato",
    ]
    if "Porcoes" not in df:
        df["Porcoes"] = pd.NA
    df_exibir = df[colunas].copy().reset_index(drop=True)

    for i, row in df_exibir.iterrows():
        cols = st.columns([5, 2, 2, 2, 2, 2, 2, 1])
        cols[0].write(row["Alimento"])
        cols[1].write(f"{row['Quantidade (g)']:.0f}")
        cols[2].write("" if pd.isna(row["Porcoes"]) else f"{row['Porcoes']:.2f}")
        cols[3].write(f"{row['Kcal']:.2f}")
        cols[4].write(f"{row['Proteina']:.2f}")
        cols[5].write(f"{row['Gordura']:.2f}")
        cols[6].write(f"{row['Carboidrato']:.2f}")
        if cols[7].button("‚ùå", key=f"{data_str}_{refeicao}_{i}"):
            refeicoes[refeicao] = df.drop(index=i).reset_index(drop=True)
            st.rerun()

    total_df = pd.concat([total_df, df], ignore_index=True)

# Totais do dia
if not total_df.empty:
    st.markdown("### Totais do dia")
    totais = somar_nutrientes(total_df)
    st.write(f"**Calorias:** {totais['Kcal']:.0f} kcal | **Prote√≠nas:** {totais['Proteina']:.1f} g | **Gorduras:** {totais['Gordura']:.1f} g | **Carboidratos:** {totais['Carboidrato']:.1f} g")

# Exportar todos os dados
st.subheader("üì¶ Exportar todos os registros")

df_export = pd.DataFrame()
for dia, dados_refeicoes in st.session_state.refeicoes_por_dia.items():
    for refeicao, df in dados_refeicoes.items():
        if not df.empty:
            df_temp = df.copy()
            df_temp["Data"] = dia
            df_temp["Refeicao"] = refeicao
            df_export = pd.concat([df_export, df_temp], ignore_index=True)

if not df_export.empty:
    st.download_button(
        label="üìÅ Baixar CSV completo",
        data=df_export.to_csv(index=False).encode("utf-8"),
        file_name="registro_alimentar_completo.csv"
    )
